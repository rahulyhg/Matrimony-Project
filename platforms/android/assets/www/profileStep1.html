<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <!-- Path to matterTheme Library CSS-->
  <link href="lib/matterTheme/styles/style.css"           rel="stylesheet" type="text/css">
  <link href="lib/matterTheme/styles/framework.css"       rel="stylesheet" type="text/css">
  <link href="lib/matterTheme/styles/font-awesome.css"    rel="stylesheet" type="text/css">
  <link href="lib/matterTheme/styles/animate.css"         rel="stylesheet" type="text/css">

  <link rel="shortcut icon" href="lib/matterTheme/images/splash/favicon.ico" type="image/x-icon" />

  <!-- Path to matterTheme Library JS-->
  <script type="text/javascript" src="lib/matterTheme/scripts/jquery.js"></script>
  <script type="text/javascript" src="lib/matterTheme/scripts/jqueryui.js"></script>
  <script type="text/javascript" src="lib/matterTheme/scripts/framework-plugins.js"></script>
  <script type="text/javascript" src="lib/matterTheme/scripts/custom.js"></script>

  <script type="text/javascript" src="lib/CryptoJS/rollups/md5.js"></script>
  <!-- Path to customize CSS-->
  <link rel="stylesheet" href="css/customize.css">
  <!-- Path to Angular JS -->
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  <script type="text/javascript">
  function onLoad(){
    document.addEventListener("deviceready",onDeviceReady, true);
    document.addEventListener("backbutton", onBackKeyDown, false);
  }

  function onDeviceReady(){
    // navigator.notification.alert("PhoneGap is working!!");
    console.log('onready');
  }

  function onBackKeyDown(e) {
    console.log('back button pressed!');
    showConfirm();
  }

  // process the confirmation dialog result
  function onConfirm(button) {
    if (button == 2) {
      navigator.app.exitApp();
    }
  }

  // Show a custom confirmation dialog
  //
  function showConfirm() {
    navigator.notification.confirm(
      'Are you sure to exit?',  // message
      onConfirm,              // callback to invoke with index of button pressed
      'Alert',            // title
      'Cancel,Exit'          // buttonLabels
    );
  }


  </script>
  <title>Collecting information step 1</title>
</head>
<body onload="onLoad()">

  <!-- Active account page -->
  <!-- <div id="content" style="padding-left: 20px; padding-right: 20px; background-color: #FFFFFF; top: 100px; bottom: 100px;left:0px;right:0px;">

  <!--Page content goes here, fixed elements go above the all elements class-->
  <div class="material-container full-bottom">
    <div class="sidebar-divider" style="padding-left: 0px">
      Let we know more about you (1/3)
    </div>
    <!-- <div class="page-profile-header container-fullscreen">
    <img src="img/5s.jpg" alt="img">
  </div> -->
  <div class="contact-form no-bottom">
    <fieldset>
      <div class="formFieldWrap">
        <!-- <label class="field-title contactNameField" for="contactNameField">Name:<span>(required)</span></label> -->
        <input type="text" placeholder="First Name" name="contactNameField" value="" class="contactField requiredField" id="txtFisrtName" maxlength="10"/>
      </div>
      <div class="formFieldWrap">
        <input type="text" placeholder="Middle Name" name="contactNameField" value="" class="contactField requiredField" id="txtMiddleName" maxlength="10"/>
      </div>
      <div class="formTextareaWrap">
        <input type="text" placeholder="Last Name" name="contactNameField" value="" class="contactField requiredField" id="txtLastName" maxlength="10"/>
      </div>
      <div class="formTextareaWrap">
        <input type="text" placeholder="Birthday" onfocus="(this.type='date')" onblur="(this.type='text')" class="contactField" id="txtBirthday"/>
      </div>
      <div class="formTextareaWrap">
        <!-- <input type="text" placeholder="Gender" name="contactNameField" value="" class="contactField requiredField" id="txtGender"/> -->
        <select class="contactField2" name="event-type" id="txtGender">
          <option value="" disabled selected style="display: none;">Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>
      <div class="formTextareaWrap">
        <input type="number" placeholder="Phone number" name="contactNameField" value="" class="contactField requiredField" id="txtPhone"/>
      </div>
      <div class="formSubmitButtonErrorsWrap contactFormButton">
        <input type="submit" onclick="nextButtonHandler()" class="buttonWrap button button-green contactSubmitButton" id="btnNext" value="Next"/>
      </div>
    </fieldset>
  </div>
</div>
<!-- Fname require -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="fnRequire">
  <p>
    First name is require!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Lname require -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="lnRequire">
  <p>
    Last name is require!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- birthday require -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="birthdayRequire">
  <p>
    Birthday is require!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Gender require -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="genderRequire">
  <p>
    Gender is require!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Phone require -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="phoneRequire">
  <p>
    Phone number is require!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Phone lenght -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="phoneLenght">
  <p>
    Phone number from 10 - 15 numbers!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- wrong birthday -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="birhdayError">
  <p>
    Your birthday is not valid!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Connection error -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="errorConnection">
  <p>
    Can't connect to server, please check your internet connection!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>
<!-- Other error -->
<div class="top-notification-2 top-notification bg-red-dark timeout-notification timer-notification" id="otherError">
  <p>
    An error has occurred when save your information. Please try again!
  </p>
  <a href="#" class="close-top-notification"><i class="fa fa-times"></i></a>
</div>

<script>
// handler next button
function nextButtonHandler(){
  disableAll();
  var userName = window.localStorage.getItem("username");
  console.log("next btn click");
  console.log(userName);
  // Check connectionStatus
  if (checkInternetConnection()) {
    // Check input data
    if (checkInput()) {
      console.log('all validated!');
      saveToServer();
    }else {
      enableAll();
    }
  }else {
    enableAll();
    showMessage("connectionError");
  }
};

function checkInput() {
  if ($("#txtFisrtName").val()=="") {
    showMessage("fnRequire");
    return false;
  }else if ($("#txtLastName").val()=="") {
    showMessage("lnRequire");
    return false;
  }else if ($("#txtBirthday").val()=="") {
    showMessage("birthdayRequire");
    return false;
  }else if ($("#txtGender option:selected").val()=="") {
    showMessage("genderRequire");
    return false;
  }else if ($("#txtPhone").val()=="") {
    showMessage("phoneRequire");
    return false;
  }else if ($("#txtPhone").val().length < 10 || $("#txtPhone").val().length > 15) {
    showMessage("phoneLenght");
    return false;
  }else if (checkBirthday($("#txtBirthday").val())) {
    return true;
  }else {
    showMessage("birhdayError");
    return false;
  }
}

function saveToServer() {
  var userName = window.localStorage.getItem("username");
  var fname = $("#txtFisrtName").val();
  var mname  = $("#txtMiddleName").val();
  var lname = $("#txtLastName").val();
  var gender = $("#txtGender option:selected").val();
  var phone = $("#txtPhone").val();
  var birthday = $("#txtBirthday").val();
  var birthdayArr = birthday.split("-");
  var formatedBirhday = birthdayArr[1]+"/"+birthdayArr[2]+"/"+birthdayArr[0];
  var userYear = parseInt(birthdayArr[0]);
  console.log("user year: " + userYear);
  var currentDate = new Date();
  var currentYear = parseInt(currentDate.getFullYear());
  age = currentYear - userYear;
  console.log(age);
  console.log(formatedBirhday);
  var dataString="&userName="+userName+"&fname="+fname+"&mname="+mname+"&lname="+lname+"&birthday="+formatedBirhday+"&age="+age+"&gender="+gender+"&phone="+phone+"&savestep1=";
  console.log(dataString);
  $.ajax({
    type: "POST",
    url:"http://139.59.254.92/saveinfo.php",
    data: dataString,
    crossDomain: true,
    cache: false,
    beforeSend: function(){ console.log('saving...');},
    success: function(data){
      console.log(data);
      // save success
      if (data=="saveSuccess") {
        enableAll();
        window.location.replace("profileStep2.html");
        console.log(dataString);
      }else if (data=="saveError") {
        // save error
        enableAll();
        showMessage('otherError');
      }
    }
  });
}

function checkBirthday(birthday) {
  var currentDate = new Date();
  var currentYear = parseInt(currentDate.getFullYear());
  var birthdayArr = birthday.split("-");
  var inputYear = parseInt(birthdayArr[0]);
  var age = currentYear - inputYear;
  console.log('age: ' + age);
  if (age <= 0 || age > 110) {
    return false;
  }else {
    return true;
  }
}

// disable all when processing
function disableAll() {
  $("#btnNext").attr("onclick","return false;");
}
// enable all when process done
function enableAll() {
  $("#btnNext").attr("onclick","nextButtonHandler()");
}

// check connection
function checkInternetConnection() {
  connectionStatus = navigator.onLine ? 'online' : 'offline';
  if (connectionStatus=='online') {
    return true;
  }else if (connectionStatus=='offline') {
    return false;
  }
}
// Show message
function showMessage(messType) {
  switch(messType) {
    case 'fnRequire':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#fnRequire').slideDown(200);
    setTimeout(function(){
      $('#fnRequire').slideUp(200);
    }, 4000);
    break;
    case 'lnRequire':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#lnRequire').slideDown(200);
    setTimeout(function(){
      $('#lnRequire').slideUp(200);
    }, 4000);
    break;
    case 'birthdayRequire':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#birthdayRequire').slideDown(200);
    setTimeout(function(){
      $('#birthdayRequire').slideUp(200);
    }, 4000);
    break;
    case 'genderRequire':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#genderRequire').slideDown(200);
    setTimeout(function(){
      $('#genderRequire').slideUp(200);
    }, 4000);
    break;
    case 'phoneRequire':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#phoneRequire').slideDown(200);
    setTimeout(function(){
      $('#phoneRequire').slideUp(200);
    }, 4000);
    break;
    case 'phoneLenght':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#phoneLenght').slideDown(200);
    setTimeout(function(){
      $('#phoneLenght').slideUp(200);
    }, 4000);
    break;
    case 'birhdayError':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#birhdayError').slideDown(200);
    setTimeout(function(){
      $('#birhdayError').slideUp(200);
    }, 4000);
    break;
    case 'connectionError':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#errorConnection').slideDown(200);
    setTimeout(function(){
      $('#errorConnection').slideUp(200);
    }, 4000);
    break;
    case 'successResend':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#successResend').slideDown(200);
    setTimeout(function(){
      $('#successResend').slideUp(200);
    }, 4000);
    break;
    case 'otherError':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#otherError').slideDown(200);
    setTimeout(function(){
      $('#otherError').slideUp(200);
    }, 4000);
    break;
    case 'invalidCodeLenght':
    $('top-notification-2, top-notification, bg-red-dark, timeout-notification, timer-notification').slideUp(200);
    $('#invalidCodeLenght').slideDown(200);
    setTimeout(function(){
      $('#invalidCodeLenght').slideUp(200);
    }, 4000);
    break;
    default:
    return false;
  }
}
</script>

<!-- <script type="text/javascript" src="controller/loginController.js"></script> -->
<!-- Cordova reference -->
<script type="text/javascript" src="cordova.js"></script>
<!-- <script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript">
app.initialize();
</script>  -->
</body>
</html>
